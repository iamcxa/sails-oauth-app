var passport = require('passport');

module.exports = {


  friendlyName: 'facebook oAuth API callback handler',


  description: 'oAuth',


  inputs: {

    // password: {
    //   description: 'The new, unencrypted password.',
    //   example: 'abc123v2',
    //   required: true
    // },
    //
    // token: {
    //   description: 'The password token that was generated by the `sendPasswordRecoveryEmail` endpoint.',
    //   example: 'gwa8gs8hgw9h2g9hg29hgwh9asdgh9q34$$$$$asdgasdggds',
    //   required: true
    // }

  },


  exits: {

    success: {
      description: 'facebook oAuth API callback handler',
    },

    invalidToken: {
      description: 'The provided password token is invalid, expired, or has already been used.',
      responseType: 'expired'
    }

  },


  fn: async function (inputs, exits, env) {

    const { req, res, next } = env;

    passport.authenticate('facebook', function(err, user) {
      if(err) {
        // redirect to login page
        console.log('google callback error: '+err);
      } else {
        console.log('facebook credentials');
        console.log(user);
        res.json(user);
      }
    })(req, res, next);
  }


};
